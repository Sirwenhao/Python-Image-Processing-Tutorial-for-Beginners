### 《Python图像处理实战》Chapter05学习笔记

主要内容：

- 图像导数——图像梯度和拉普拉斯算子
- 锐化和反锐化掩模
- 使用导数和滤波器进行边缘检测
- 图像金字塔——融合图像

图像$I即函数(f(x,y))$的梯度的大小对应于图像中边缘部分的强度，图像梯度的方向垂直于边缘。在输入图像中，强度（灰度值）剧烈变化的位置对应于图像一阶导数强度中有尖峰或谷的位置。简单来说，梯度幅值的峰值表示边缘的位置，对梯度幅值设定阈值可以找到图像中的边缘信息。

#### 一阶偏导对应与卷积核的对应关系：

$\frac{\partial f}{\partial x}=f(x+1)-f(x)$对应于卷积核$\begin{bmatrix} -1 & 1 \end{bmatrix}$，$\frac{\partial f}{\partial y}=f(y+1)-f(y)$对应于卷积核$\begin{bmatrix} -1 \\ 1 \end{bmatrix}$，中心差分对应卷积核$\frac{\partial f}{\partial x}=\frac{f(x+1)-f(x-1)}{2}$对应于卷积核$\begin{bmatrix}-1 & 0 & 1 \end{bmatrix}$

#### 拉普拉斯算子

拉普拉斯算子近似于图像的二阶导数，用于检测边缘，零交叉点用于标记边缘位置。

拉普拉斯算子于其对应的卷积核:

$\bigtriangledown^2f=\frac{\partial^{2}f}{\partial^{2}x^2}+\frac{\partial^{2}f}{\partial^{2}y^2}=f(x+1,y)+f(x-1,y)+f(x,y+1),f(x,y-1)-4f(x,y)$对应的卷积核为：$\begin{bmatrix}0 & 1 & 0 \\1 & -4 & 1 \\ 0 & 1 & 0 \end{bmatrix}$

对拉普拉斯算子的几个关键点说明：

- $\bigtriangledown^2f$是一个标量，也就意味之拉普拉斯算子没有任何的方向信息
- 拉普拉斯算子对于噪声非常敏感，因此在使用拉普拉斯算子之前需要对其进行平滑处理（例如使用高斯滤波器滤波）

#### 锐化和反锐化掩模

锐化的目的是图像的细节信息或增强模糊的细节

##### 使用拉普来滤波器来锐化图像的一般步骤

1. 对原始输入图像应用拉普拉斯滤波器
2. 将步骤一得到的图像与原始图像进行叠加(所得即锐化后的图像)

##### 反锐化掩模

反锐化掩模是一种用于锐化图像的技术，即从图像本身减去图像的模糊版本，用于反锐化掩模的典型混合公式如下：
$$
锐化图像=原始图像+(原始图像-模糊图像)\times 总数
$$
锐化后的图像与原始图像机器细节图像的关系：
$$
原始图像-模糊图像=细节图像\\
(用高斯滤波器)\\
原始图像+\alpha*(细节图像)=锐化图像
$$

#### 使用导数和滤波器的边缘检测

图像边缘：图像强度函数中突然发生急剧变化（不连续）的像素一般对应于图像的边缘，而边缘检测所要实现的任务，就是找出这些变化剧烈的区域。边缘检测一般是通过设定阈值，对梯度图像进行阈值化处理所得。

##### 常用的一阶二阶图像边缘检测滤波器滤波核：

- 逼近一阶图像倒数的滤波器：
  - Sobel滤波器：$$Sobel_x \begin{bmatrix}1&0&-1\\2&0&-1\\1&0&-1\end{bmatrix}$$，$$Sobel_y \begin{bmatrix}1&2&1\\0&0&0\\-1&-2&-1\end{bmatrix}$$
  - Scharr滤波器：$$Scharr_x \begin{bmatrix}3&0&-3\\10&0&-10\\3&0&-3\end{bmatrix}$$，$$Scharr_y \begin{bmatrix}3&10&3\\0&0&0\\-3&-10&-3\end{bmatrix}$$
  - Prewitt滤波器：$$Prewitt_x \begin{bmatrix}1&0&-1\\1&0&-1\\1&0&-1\end{bmatrix}$$，$$Scharr_y \begin{bmatrix}1&1&1\\0&0&0\\1&1&1\end{bmatrix}$$
  - Roberts滤波器：$$Roberts_x \begin{bmatrix}0&1\\-1&\end{bmatrix}$$，$$Roberts_y \begin{bmatrix}1&0\\0&1\end{bmatrix}$$

- 逼近二阶图像倒数的滤波器：
  - Laplace滤波器：$$Laplace \begin{bmatrix}0&-1&0\\-1&4&-1\\0&-1&0\end{bmatrix}$$

边缘检测的后处理步骤是非最大抑制，会使得一阶倒数的得到的边缘变薄，上述滤波器还不具备此种功能。Canny算子是一种功能先进、水平顶尖的边缘检测滤波器，可以实现对于滤波后的边缘非最大抑制处理。

##### Canny边缘检测器的一般步骤：

1. 平滑/去噪，边缘检测一般对于噪声较为敏感，因此需要先使用高斯滤波器进行平滑滤波处理
2. 计算梯度的大小和方向，对图像应用Sobel水平滤波器和垂直滤波器，计算每个图像的边缘梯度大小和方向，所计算出的梯度角被四舍五入为四个角中的一个，用以表示每个像素的水平、垂直和两个对角线方向
3. 非最大值抑制，任何未使用的可能不能构成边缘的像素被删除，这一步需要检查它是否是梯度方向上邻域内的局部最大值
4. 链接和滞后阈值，这一步确定所检测到的边缘是否为强边缘。使用两个(滞后)阈值$max\_val$和$min\_val$，边缘强度的梯度值高于$max\_val$被保存，低于$min\_val$被删除。根据阈值之间的连通性，划分边缘和非边缘，如果和"确定边"元素相连，则被认为是边缘的一部分，否则丢弃

此处，所使用的高斯平滑滤波器的强度参数的大小会影响边缘检测的效果。

##### LoG滤波器和DoG滤波器

高斯拉普拉斯滤波器（Laplacian of Gaussian，LoG）是一种线性滤波器，本质是对图像进行高斯滤波后紧接着使用拉普拉斯滤波器的组合